@page "/HomeInfoWakaf"

<PageTitle>Dashboard Info Maklumat Wakaf</PageTitle>

@layout MainLayoutAwam
@using CurrieTechnologies.Razor.SweetAlert2
@using DAL.Entiti
@using IdentityAuthentication
@using Microsoft.AspNetCore.Authorization
@using SAL
@using System.Security.Claims
@using System.Web
@using eTakaf2025.Components.Layout

@attribute [Authorize]
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer
@inject IServices _service
@inject SweetAlertService Swal
@inject IConfiguration _conf
@inject NavigationManager NavMan
@inject IIdentityAuthenticationLib myIden

<div class="container-fluid">
    <div class="card">
        <div class="primary-tabs">
            <ul class="nav nav-tabs" id="primaryTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#dashboard1" type="button" role="tab" aria-controls="products" aria-selected="true">
                        <i class="bi bi-grid me-2"></i>DASHBOARD
                    </button>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="dashboard1" role="tabpanel" aria-labelledby="products-tab">
                <div class="container-fluid">
                    <div class="row  justify-content-center mt-5 mb-5 d-flex">
                        <div class="card stat-card shadow-lg w-50">
                            <div class="card-header bg-success text-white text-center">
                                <h5 class="mb-0"> WAKAF TANAH/BANGUNAN SEDIA UNTUK DISEWA</h5>
                            </div>
                            <div class="card-body text-center">
                                <h5 class="card-title mb-0">JUMLAH KESELURUHAN</h5>
                                <div class="stat-value mt-2" style="color:red;">@JumlahRekod</div>
                                <div class="stat-label fw-bolder"></div>
                                <hr />
                                <div class="row text-center pe-2 mt-3">
                                    <div class="col-6 border-end">
                                        <h6 class="card-title text-primary mb-0">WAKAF AM</h6>
                                        <div class="stat-value1 mt-2" style="cursor: pointer;color: #d6a80c ;">@TanahKosongTWA</div>
                                        <div class="stat-label fw-bold"></div>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="card-title text-warning mb-0">WAKAF KHAS</h6>
                                        <div class="stat-value1 mt-2" style="cursor: pointer;color: #94a90c ;">@TanahKosongTWK</div>
                                        <div class="stat-label fw-bold"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    @if (isAdaRekod)
                    {
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="row justify-content-center">
                                <div class="stat-card">
                                    <div class="col-sm-12">
                                        <div class="alert alert-success d-flex align-items-center mb-3" role="alert">
                                            @*  <i class="bi bi-check-circle-fill text-success me-3 fs-5"></i> *@
                                            <div class="flex-grow-3" data-bs-toggle="modal" data-bs-target="#infoModal" style="cursor: pointer;">
                                                <strong>Senarai Permohonan Penyewaan Saya </strong>
                                                <div class="text-center"><span class="badge bg-danger badge-counter text-center">@JumlahRekodPerNoKP</span></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    }


                </div>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid mt-5  d-flex justify-content-center">
    <div class="card shadow-sm rounded-4 border-0 w-75">
        <div class="card-header bg-primary text-white rounded-top-4">
            <h5 class="mb-0 fw-semibold"><i class="bi bi-table me-2"></i>Senarai Tanah/Bangunan Wakaf</h5>
        </div>

        <div class="card-body bg-light rounded-bottom-4">
            @if (adaRekod)
            {
                <div class="table-responsive">
                    @if (adaRekod)
                    {
                        <div class="table-responsive">
                            <table id="myTable" class="table table-hover align-middle text-nowrap table-bordered border-light-subtle rounded-3 overflow-hidden">
                                <thead class="table-success text-center align-middle">
                                    <tr>
                                        <td>Bil</td>
                                        <td>Daerah</td>
                                        <td>Mukim</td>
                                        <td>Jenis Wakaf</td>
                                        <td>Geran Hak Milik</td>
                                        <td>No Lot</td>
                                        <td>Kategori</td>
                                        <td>Luas Diwakafkan (Ha)</td>
                                        <td>Status</td>
                                        <td>Info</td>
                                        <td>Permohonan Penyewaan</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var data in _data)
                                    {
                                        <tr>
                                            <td>@data.BIL</td>
                                            <td class="text-center fw-bold">@data.DAERAH</td>
                                            <td class="text-center fw-bold text-primary">@data.MUKIM_PEKAN_BANDAR</td>
                                            <td class="text-center text-success">@data.JENIS_WAKAF</td>
                                            <td class="text-center text-danger">@data.JENIS_NO_HAKMILIK</td>
                                            <td class="text-center text-primary">@data.NO_LOT</td>
                                            <td class="text-center text-warning">@data.KEGUNAAN_KATEGORI</td>
                                            <td class="fw-bold text-center">@data.KELUASAN_YANG_DIWAKAFKAN_ha.ToString("N2")</td>
                                            <td>
                                                @if (data.Status == 2)
                                                {
                                                    <span class="badge bg-warning"><i class="fa-regular fa-stars text-primary pe-2"></i>Di tempah</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-success">Masih Kosong</span>
                                                }
                                            </td>
                                            <td>
                                                <button title="Info Lanjut" data-bs-toggle="modal" data-bs-target="#staticCenteredModal" class="btn btn-icon btn-outline-success rounded-pill btn-wave" @onclick="() => getInfoDetails(data)">
                                                    <i class="fa-regular fa-circle-info"></i>
                                                </button>
                                            </td>
                                            <td class="text-center">

                                                <button disabled="@(!IsButtonEnabled(data.Status))" title="Permohonan Penyewaan" data-bs-toggle="modal" data-bs-target="#QueryModal" class="btn btn-icon btn-outline-danger rounded-pill btn-wave" @onclick="() => getInfoDetails(data)">
                                                    <i class="fa-regular fa-clipboard-question"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<div class="modal fade" id="staticCenteredModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Informasi Tanah/Bangunan Wakaf</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="row">
                    <!-- Location Information -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-geo-alt"></i>
                                </div>
                                <h6 class="section-title">Maklumat Lokasi</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Alamat</div>
                                <div class="info-value">@AlamatPremis</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Daerah</div>
                                <div class="info-value">@Daerah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Mukim</div>
                                <div class="info-value">@Mukim</div>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Information -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-house-door"></i>
                                </div>
                                <h6 class="section-title">Maklumat Wakaf</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Pewakaf</div>
                                <div class="info-value">@Pewakaf</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Hartanah</div>
                                <div class="info-value">@NamaHartanah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Jenis Hartanah</div>
                                <div class="info-value">@JenisHartanah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Kategori</div>
                                <div class="info-value">@Kategori</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Jenis Wakaf</div>
                                <div class="info-value">@KategoriSumberAmWakaf</div>
                            </div>
                        </div>
                    </div>

                    <!-- Land Area -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-rulers"></i>
                                </div>
                                <h6 class="section-title">Keluasan Tanah/Bangunan</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Keluasan DiWakafkan (Ha)</div>
                                <div class="info-value">@LuasTanahDiwakafkanHa.ToString("N2")</div>
                            </div>
                        </div>
                    </div>

                    <!-- Property Details -->
                    <div class="col-md-12 col-lg-8">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-file-earmark-text"></i>
                                </div>
                                <h6 class="section-title">Maklumat Harta</h6>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <div class="info-label">No. Lot</div>
                                        <div class="info-value">@NoLot</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Nombor Geran</div>
                                        <div class="info-value">@NoGeran</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Pegangan Hartanah</div>
                                        <div class="info-value">@PeganganTanah</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <div class="info-label">Pajakan</div>
                                        <div class="info-value">@TempohPajakan</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Syarat Nyata Tanah</div>
                                        <div class="info-value">@SyaratNyataTanah</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="QueryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background :linear-gradient(135deg, #50AD36, #42DF16) !important;color:white;">
                <h5 class="modal-title">PERMOHONAN PENYEWAAN TANAH/BANGUNAN WAKAF DIBAWAH MAINS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="info-label">Nama Pemohon :</label>
                        <input type="text" readonly class="form-control fw-bold text-danger" @bind="NamaPemohon" />
                    </div>
                    <div class="col-md-6">
                        <label class="info-label">No. Kad Pengenalan :</label>
                        <input type="text" readonly class="form-control fw-bold text-danger" @bind="NOKP" />
                    </div>
                </div>
                <div class="row mb-5">
                    <p class="fw-bold">Tujuan Penyewaan (boleh memilih lebih dari satu pilihan)</p>
                    <div class="col-md-12">
                        @foreach (var item in items)
                        {
                            <div class="form-check form-check-inline">
                                <input type="checkbox" class="btn-check"
                                       id="@item.Id"
                                       value="@item.Value"
                                       @onchange="(e) => UpdateSelection(e, item.Value)">
                                <label class="btn btn-outline-success me-2" for="@item.Id">@item.Label</label>
                            </div>
                        }
                    </div>
                </div>
                <div class="row">
                    <!-- Location Information -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-geo-alt"></i>
                                </div>
                                <h6 class="section-title">Maklumat Lokasi</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Alamat</div>
                                <div class="info-value">@AlamatPremis</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Daerah</div>
                                <div class="info-value">@Daerah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Mukim</div>
                                <div class="info-value">@Mukim</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Keluasan DiWakafkan (Ha)</div>
                                <div class="info-value">@LuasTanahDiwakafkanHa.ToString("N2")</div>
                            </div>
                        </div>
                    </div>

                    @*   <!-- Basic Information -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-house-door"></i>
                                </div>
                                <h6 class="section-title">Maklumat Wakaf</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Pewakaf</div>
                                <div class="info-value">@Pewakaf</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Hartanah</div>
                                <div class="info-value">@NamaHartanah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Jenis Hartanah</div>
                                <div class="info-value">@JenisHartanah</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Kategori</div>
                                <div class="info-value">@Kategori</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Jenis Wakaf</div>
                                <div class="info-value">@KategoriSumberAmWakaf</div>
                            </div>
                        </div>
                    </div>

                    <!-- Land Area -->
                    <div class="col-md-6 col-lg-4">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-rulers"></i>
                                </div>
                                <h6 class="section-title">Keluasan Tanah/Bangunan</h6>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Keluasan DiWakafkan (Ha)</div>
                                <div class="info-value">@LuasTanahDiwakafkanHa.ToString("N2")</div>
                            </div>
                        </div>
                    </div> *@

                    <!-- Property Details -->
                    <div class="col-md-12 col-lg-8">
                        <div class="info-section">
                            <div class="section-header">
                                <div class="section-icon">
                                    <i class="bi bi-file-earmark-text"></i>
                                </div>
                                <h6 class="section-title">Maklumat Harta</h6>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-item">
                                        <div class="info-label">No. Lot</div>
                                        <div class="info-value">@NoLot</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Nombor Geran</div>
                                        <div class="info-value">@NoGeran</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Pegangan Hartanah</div>
                                        <div class="info-value">@PeganganTanah</div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="info-item">
                                        <div class="info-label">Pajakan</div>
                                        <div class="info-value">@TempohPajakan</div>
                                    </div>

                                    <div class="info-item">
                                        <div class="info-label">Syarat Nyata Tanah</div>
                                        <div class="info-value">@SyaratNyataTanah</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" @onclick="HantarSewa" class="btn btn-success btn-lg"><i class="fa-light fa-floppy-disk pe-2"></i>Hantar Permohonan Penyewaan</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="infoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background :linear-gradient(135deg, #50AD36, #42DF16) !important;color:white;">
                <h5 class="modal-title">Informasi Permohonan Penyewaan</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="row mt-auto d-flex justify-content-center">
                    @if (isAdaRekod)
                    {
                        <div class="table table-responsive">
                            <table id="myTableXX" class="table table-hover align-middle text-nowrap table-bordered border-light-subtle rounded-3 overflow-hidden">
                                <thead class="table-success text-center align-middle">
                                    <tr>
                                        <td>#</td>
                                        <td>Daerah</td>
                                        <td>Mukim</td>
                                        <td>No Lot</td>
                                        <td>No Geran</td>
                                        <td>Status Sekarang</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var xd in _dataIndividual)
                                    {
                                        <tr>
                                            <td>@xd.Bil</td>
                                            <td class="fw-bold text-danger">@xd.Daerah</td>
                                            <td class="fw-bold text-primary">@xd.Mukim</td>
                                            <td>@xd.NoLot</td>
                                            <td>@xd.NoGeran</td>
                                            @{
                                                var (statusText, badgeClass) = xd.Status switch
                                                {
                                                    1 => ("Baru Mohon", "success"),
                                                    2 => ("Dalam Semakan/Proses", "danger"),
                                                    3 => ("Semakan Kelulusan", "warning"),
                                                    4 => ("Lulus", "primary"),
                                                    5 => ("Ditolak", "secondary"),
                                                    _ => ("Tidak Diketahui", "dark")
                                                };
                                            }
                                            <td>
                                                <span class="badge bg-@badgeClass">@statusText</span>
                                            </td>

                                        </tr>
                                    }
                                </tbody>
                            </table>

                        </div>
                    }
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




@code {

    public string Mode = string.Empty;
    public bool adaRekod = false;
    public int TanahKosongTWA = 0; public int TanahKosongTWK = 0;

    IEnumerable<tblInfoTanahWakaf> _data = []; IEnumerable<tblInfoUsereTakaf> _userInfo = [];
    public int JumlahRekod = 0;
    public bool isAdaRekod = false;
    public bool isDisable = false;

    public tblInfoTanahWakaf _updateData = new tblInfoTanahWakaf();
    IEnumerable<tblInfoPermohonanPenyewaan> _dataIndividual = [];
    public int JumlahRekodPerNoKP = 0;

    public string TujuanPenyewaan = string.Empty;
    public string AlamatPremis = string.Empty; public string Pewakaf = string.Empty;
    public string NamaPenyewaPenghuni = string.Empty;
    public string NamaHartanah = string.Empty;
    public double LuasTanahM2;
    public double LuasTanahDalamGeran;
    public double LuasTanahEkar;
    public double LuasTanahDiwakafkanHa;
    public double LuasTanahDiwakafkanEkar;
    public string JenisHartanah = string.Empty;
    public string NoLot = string.Empty;
    public string NoGeran = string.Empty;
    public string Mukim = string.Empty;
    public string Daerah = string.Empty;
    public string PeganganTanah = string.Empty;
    public string TempohPajakan = string.Empty;
    public string SyaratNyataTanah = string.Empty;
    public string KategoriSumberAmWakaf = string.Empty;
    public string StatusPenghunian = string.Empty;
    public string Kategori = string.Empty;
    public string Tempoh = string.Empty;

    public string NOKP = string.Empty;
    public string NamaPemohon = string.Empty;

    private async Task LoadFile()
    {
        await JSRuntime.InvokeVoidAsync("loadSweetAlert");
    }

    private bool IsButtonEnabled(int? status)
    {
        return status == 1;
    }

    //----------
    private List<string> selectedValues = new();
    private List<CheckboxItem> items = new()
    {
        new() { Id = "btncheck1", Value = "Sewa Rumah Wakaf", Label = "Sewaan Rumah" },
        new() { Id = "btncheck2", Value = "Sewa Bangunan Wakaf", Label = "Sewaan Bangunan" },

        new() { Id = "bc1", Value = "Pertanian Kontan", Label = "Penanaman Kontan" },
        new() { Id = "bc2", Value = "Pertanian Sayuran", Label = "Penanaman Sayur Sayuran" },
        new() { Id = "bc3", Value = "Pertanian Nenas", Label = "Penanaman Nenas" },
        new() { Id = "bc4", Value = "Pertanian Cili", Label = "Penanaman Cili" },
        new() { Id = "bc5", Value = "Pertanian Ubi Kayu", Label = "Penanaman Ubi Kayu" },
        new() { Id = "bc6", Value = "Pertanian Keledek", Label = "Penanaman Keledek" },
        new() { Id = "bc7", Value = "Pertanian Bendi", Label = "Penanaman Bendi" },
        new() { Id = "bc8", Value = "Pertanian Labu", Label = "Penanaman Labu" },
        new() { Id = "bc9", Value = "Pertanian Kantan", Label = "Penanaman Kantan" },
        new() { Id = "bc10", Value = "Pertanian Tebu", Label = "Penanaman Tebu" },
        new() { Id = "bc11", Value = "Pertanian Terung", Label = "Penanaman Terung" },
        new() { Id = "bc12", Value = "Pertanian Serai", Label = "Penanaman Serai" },
        new() { Id = "bc13", Value = "Pertanian Pisang", Label = "Penanaman Pisang" },
        new() { Id = "bc14", Value = "Pertanian Kelapa", Label = "Penanaman Kelapa" },
        new() { Id = "bc15", Value = "Pertanian Durian", Label = "Penanaman Durian" },
        new() { Id = "bc16", Value = "Pertanian Sawit", Label = "Penanaman Sawit" },
        new() { Id = "bc17", Value = "Pertanian Getah", Label = "Penanaman Getah" },


        new() { Id = "btncheck10", Value = "Penternakan Lembu", Label = "Penternakan Lembu" },
        new() { Id = "btncheck11", Value = "Penternakan Kerbau", Label = "Penternakan Kerbau" },
        new() { Id = "btncheck12", Value = "Penternakan Kambing", Label = "Penternakan Kambing" },
        new() { Id = "btncheck13", Value = "Penternakan Rusa", Label = "Penternakan Rusa" },
        new() { Id = "btncheck16", Value = "Penternakan Landak", Label = "Penternakan Landak" },
        new() { Id = "btncheck14", Value = "Penternakan Ayam", Label = "Penternakan Ayam" },
        new() { Id = "btncheck15", Value = "Penternakan Itik", Label = "Penternakan Itik" }



    };

    private void UpdateSelection(ChangeEventArgs e, string value)
    {
        if ((bool)e.Value!)
            selectedValues.Add(value);
        else
            selectedValues.Remove(value);
    }

    public class CheckboxItem
    {
        public string Id { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
        public string Label { get; set; } = string.Empty;
    }
    //--------------------------







    protected override async Task OnInitializedAsync()
    {
        Mode = _conf["Mode"]?.ToString() ?? string.Empty;
        var authState = await myIden.GetUserAsync();
        var user = authState.Identity as ClaimsIdentity;
        NOKP = user?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Role)?.Value ?? "";
        if (user == null || !user.IsAuthenticated)
        {
            await myIden.SignOutUserAsync();
            string baseUrl = (Mode == "Dev") ? "/SessiTamat" : "/e-Takaf/SessiTamat";
            NavMan.NavigateTo(NavMan.ToAbsoluteUri(baseUrl).ToString(), true);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadFile();
            _data = await _service.GetDetailsTanahWakafKosongForAKForPublic();
            if (_data.Any()) adaRekod = true;


            _dataIndividual = await _service.GetRecordPermohonanPenyewaanMelaluiNOKP(NOKP);
            if (_dataIndividual.Any()) isAdaRekod = true; JumlahRekodPerNoKP = _dataIndividual.Count();

            await Task.Delay(300);
            await JSRuntime.InvokeVoidAsync("initializeDataTable", "myTable");
            await JSRuntime.InvokeVoidAsync("initializeDataTablesForAll");

            await Task.Delay(300);
            await JSRuntime.InvokeVoidAsync("initializeDataTable", "myTableXX");
            await JSRuntime.InvokeVoidAsync("initializeDataTablesForAll");

            TanahKosongTWA = await _service.CountJumlahTWAKosongBothKategori();
            TanahKosongTWK = await _service.CountJumlahTWKKosongBothKategori();

            JumlahRekod = _data.Count();
            StateHasChanged();
        }
    }

    public tblInfoPermohonanPenyewaan newData = new();

    private async Task HantarSewa()
    {

        try
        {
            if (selectedValues.Count() >= 1)
            {
                SweetAlertResult result = await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Adakah Anda Pasti Untuk Menghantar Permohonan Untuk Menyewa Tanah/Bangunan Ini ?",
                    Text = "Info",
                    Icon = SweetAlertIcon.Info,
                    ShowCancelButton = true,
                    ConfirmButtonText = "Ya",
                    CancelButtonText = "Tidak"
                });

                if (!string.IsNullOrEmpty(result.Value))
                {
                    string combined = string.Join(",", selectedValues);

                    newData = new()
                    {
                        CreatedDate = DateTime.Now,
                        NoKPPemohon = NOKP,
                        NamaPemohon = NamaPemohon,
                        Daerah = Daerah,
                        Mukim = Mukim,
                        NoLot = NoLot,
                        NoGeran = NoGeran,
                        TujuanPenyewaan = combined,
                        Status = 1
                    };

                    bool isSuccess = await _service.InsertNewPenyewaanRekod(newData);
                    bool isSuccess1 = await _service.UpdateStatusPenyewaanTanahWakaf(_updateData);

                    // Close the modal first
                    await JSRuntime.InvokeVoidAsync("closeModal", "QueryModal");

                    // Prepare SweetAlert options
                    var alertOptions = new SweetAlertOptions
                    {
                        Title = isSuccess
                            ? "Permohonan Untuk Penyewaan Tanah/Bangunan Wakaf Telah BERJAYA Dihantar Untuk Diproses."
                            : "Permohonan Untuk Penyewaan Tanah/Bangunan Wakaf Telah TIDAK BERJAYA Dihantar Untuk Diproses.",
                        Text = isSuccess ? "Info" : "Error",
                        Icon = isSuccess ? SweetAlertIcon.Info : SweetAlertIcon.Error,
                        ShowCancelButton = false,
                        ConfirmButtonText = "Ya"
                    };

                    // Show SweetAlert
                    await Swal.FireAsync(alertOptions);

                    // Navigate
                    string baseUrl = (Mode == "Dev") ? "/HomeInfoWakaf" : "/e-Takaf/HomeInfoWakaf";
                    NavMan.NavigateTo(NavMan.ToAbsoluteUri(baseUrl).ToString(), true);
                    StateHasChanged();

                }
            }
            else
            {
                SweetAlertResult result = await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Pastikan Tujuan Penyewaan Dinyatakan",
                    Text = "Tujuan Penyewaan ??",
                    Icon = SweetAlertIcon.Error,
                    ConfirmButtonText = "Ya"
                });
            }
        }
        catch (System.Exception err)
        {
            throw new Exception(err.Message);
        }

    }

    private async Task getInfoDetails(tblInfoTanahWakaf xdata)
    {
        try
        {
            _userInfo = await _service.GetLoginInfo(NOKP);
            if (_userInfo.Any())
            {
                NamaPemohon = _userInfo.FirstOrDefault()?.NamaPemohon.ToString().ToUpper() ?? "";
            }


            var asknolot = xdata.NO_LOT; var askdaerah = xdata.DAERAH;

            _updateData = new()
            {
                NO_LOT = xdata.NO_LOT,
                JENIS_NO_HAKMILIK = xdata.JENIS_NO_HAKMILIK,
                DAERAH = xdata.DAERAH,
                MUKIM_PEKAN_BANDAR = xdata.MUKIM_PEKAN_BANDAR
            };

            IEnumerable<OutputCarian> infoDat = await _service.GetInfoDetailsBothTables(asknolot, askdaerah);
            if (infoDat.Any())
            {
                var dataa = infoDat.FirstOrDefault();

                Pewakaf = dataa?.PEWAKAF ?? "";
                AlamatPremis = dataa?.Alamat_Premis ?? "";
                NamaPenyewaPenghuni = dataa?.NamaPenyewaPenghuni ?? "";
                NamaHartanah = dataa?.NamaHartanah ?? "";
                LuasTanahM2 = Convert.ToDouble(dataa?.LuasTanahm2 ?? 0);
                LuasTanahDiwakafkanHa = Convert.ToDouble(xdata.KELUASAN_YANG_DIWAKAFKAN_ha);
                JenisHartanah = dataa?.JenisHartanah ?? "";
                NoLot = dataa?.NoLot ?? "";
                NoGeran = dataa?.JENIS_NO_HAKMILIK ?? "";
                Mukim = dataa?.MUKIM_PEKAN_BANDAR ?? "";
                Daerah = dataa?.Daerah ?? "";
                PeganganTanah = dataa?.PeganganTanah ?? "";
                TempohPajakan = dataa?.TempohPajakan ?? "";
                SyaratNyataTanah = dataa?.SyaratNyataTanah ?? "";
                KategoriSumberAmWakaf = dataa?.JENIS_WAKAF ?? "";
                StatusPenghunian = dataa?.StatusPenghunian ?? "";
                Kategori = dataa?.Kategori ?? "";
                Tempoh = dataa?.Tempoh ?? "";

            }



        }
        catch (System.Exception err)
        {
            throw new Exception(err.Message);
        }
    }


}
